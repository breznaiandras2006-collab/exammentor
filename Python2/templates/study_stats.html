{% extends "base.html" %}
{% block content %}
<h1>ğŸ“Š Study Stats</h1>

<div class="card">
  <form method="get" action="/study/stats">
    <label class="muted">Dokumentum szÅ±rÅ‘ (opcionÃ¡lis)</label>
    <select class="input" name="doc">
      <option value="">â€” Ã¶sszes â€”</option>
      {% for d in docs %}
        {% if doc_selected == d.id %}
          <option value="{{ d.id }}" selected>ğŸ“„ {{ d.title }}</option>
        {% else %}
          <option value="{{ d.id }}">ğŸ“„ {{ d.title }}</option>
        {% endif %}
      {% endfor %}
    </select>
    <div class="actions">
      <button type="submit">ğŸ” SzÅ±rÃ©s</button>
      <a class="buttonlike" href="/study/export/csv{% if doc_selected %}?doc={{ doc_selected }}{% endif %}">â¬‡ï¸ Export CSV</a>
      <a class="buttonlike" href="/study">â†©ï¸ Study</a>
    </div>
  </form>
</div>

<div class="card">
  <h2>Ã–sszkÃ©p</h2>
  <p class="muted">Ã–sszes kÃ¡rtya: <b>{{ total }}</b> | EsedÃ©kes: <b>{{ due }}</b>
</p>

  {% if not doc_selected %}
    <h3>ğŸ“„ DokumentumonkÃ©nt</h3>
    <div class="muted" style="margin-bottom:8px;">KÃ¡rtyÃ¡k + esedÃ©kes + utolsÃ³ 7 nap review-jei.</div>
    <div style="overflow:auto;">
      <table style="width:100%; border-collapse:collapse;">
        <thead>
          <tr>
            <th style="text-align:left; padding:8px; border-bottom:1px solid #222;">Dokumentum</th>
            <th style="text-align:right; padding:8px; border-bottom:1px solid #222;">KÃ¡rtya</th>
            <th style="text-align:right; padding:8px; border-bottom:1px solid #222;">EsedÃ©kes</th>
            <th style="text-align:right; padding:8px; border-bottom:1px solid #222;">7 nap review</th>
            <th style="text-align:right; padding:8px; border-bottom:1px solid #222;">7 nap %</th>
          </tr>
        </thead>
        <tbody>
        {% for r in by_doc %}
          {% if r.total > 0 %}
          <tr>
            <td style="padding:8px; border-bottom:1px solid #1b1b1b;">
              <a href="/study/stats?doc={{ r.document_id }}">ğŸ“„ {{ r.document_title }}</a>
            </td>
            <td style="padding:8px; border-bottom:1px solid #1b1b1b; text-align:right;">{{ r.total }}</td>
            <td style="padding:8px; border-bottom:1px solid #1b1b1b; text-align:right;">{{ r.due }}</td>
            <td style="padding:8px; border-bottom:1px solid #1b1b1b; text-align:right;">{{ r.rev7 }}</td>
            <td style="padding:8px; border-bottom:1px solid #1b1b1b; text-align:right;">
              {% if r.acc7 is none %}â€”{% else %}{{ r.acc7 }}%{% endif %}
            </td>
          </tr>
          {% endif %}
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}

  <h3>ğŸ“¦ Box eloszlÃ¡s</h3>
  <ul>
    <li>Box 1: {{ dist[1] }}</li>
    <li>Box 2: {{ dist[2] }}</li>
    <li>Box 3: {{ dist[3] }}</li>
    <li>Box 4: {{ dist[4] }}</li>
    <li>Box 5: {{ dist[5] }}</li>
  </ul>

  <h3>ğŸ¯ UtolsÃ³ 50 review</h3>
  {% if acc.n == 0 %}
    <p class="muted">MÃ©g nincs review adat.</p>
  {% else %}
    <p class="muted">
      N={{ acc.n }} | âœ… {{ acc.correct }} | âŒ {{ acc.wrong }} | TalÃ¡lati arÃ¡ny: <b>{{ acc.rate }}%</b>
    </p>
  {% endif %}

</div>

<div class="card">
  <h2>ğŸ”¥ Gyenge kÃ¡rtyÃ¡k (box=1)</h2>
  {% if not weak %}
    <p class="muted">Nincs kÃ¼lÃ¶n kiemelt gyenge kÃ¡rtya.</p>
  {% else %}
    <ul>
      {% for c in weak %}
        <li style="margin-bottom:12px;">
          <b>Q:</b> {{ c.question }}
          <div class="muted">
            box={{ c.box }} | due={{ c.due_at }}
            {% if c.document_title %} | ğŸ“„ {{ c.document_title }}{% endif %}
            {% if c.last_result is not none %} | last={{ 'âœ…' if c.last_result==1 else 'âŒ' }}{% endif %}
          </div>
          <div class="muted">{{ c.answer[:180] }}{% if c.answer|length > 180 %}â€¦{% endif %}</div>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
</div>
{% endblock %}
